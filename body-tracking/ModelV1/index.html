<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTracker Pro - AI Fitness Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .exercise-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .exercise-card:hover::before {
            left: 100%;
        }

        .exercise-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .exercise-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
        }

        .exercise-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .exercise-card p {
            opacity: 0.8;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .start-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .stats-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #ffd700;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }

        .workout-window {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        .workout-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            min-width: 500px;
            max-width: 90vw;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .webcam-placeholder {
            width: 100%;
            height: 400px;
            background: #1a1a1a;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1rem 0;
            border: 2px dashed #555;
            position: relative;
            overflow: hidden;
        }

        #videoElement {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 15px;
        }

        #canvasElement {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        .angle-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
        }

        .pose-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #00ff88;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
        }

        .exercise-counter {
            font-size: 3rem;
            font-weight: 700;
            color: #00ff88;
            margin: 1rem 0;
        }

        .exercise-status {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #ffd700;
        }

        .control-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .control-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-workout-btn {
            background: #00ff88;
            color: #1a1a1a;
        }

        .start-workout-btn:hover {
            background: #00cc6a;
            transform: scale(1.05);
        }

        .stop-btn {
            background: #ff4757;
            color: white;
        }

        .stop-btn:hover {
            background: #ff3742;
            transform: scale(1.05);
        }

        .reset-btn {
            background: #ffa502;
            color: white;
        }

        .reset-btn:hover {
            background: #ff9500;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .exercises-grid {
                grid-template-columns: 1fr;
            }

            .workout-content {
                min-width: 90vw;
                margin: 1rem;
            }

            .control-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèãÔ∏è FitTracker Pro</h1>
            <p>AI-Powered Exercise Counter & Form Tracker</p>
        </div>

        <div class="exercises-grid">
            <div class="exercise-card" onclick="startExercise('pushups')">
                <span class="exercise-icon">üí™</span>
                <h3>Push-ups</h3>
                <p>Track your push-ups with AI-powered form analysis and automatic counting</p>
                <button class="start-btn">Start Workout</button>
            </div>

            <div class="exercise-card" onclick="startExercise('squats')">
                <span class="exercise-icon">ü¶µ</span>
                <h3>Squats</h3>
                <p>Perfect your squat form while counting reps automatically using pose detection</p>
                <button class="start-btn">Start Workout</button>
            </div>

            <div class="exercise-card" onclick="startExercise('dumbbells')">
                <span class="exercise-icon">üèãÔ∏è</span>
                <h3>Dumbbell Curls</h3>
                <p>Monitor your bicep curls with precise angle measurement and rep counting</p>
                <button class="start-btn">Start Workout</button>
            </div>

            <div class="exercise-card" onclick="startExercise('jumps')">
                <span class="exercise-icon">ü§∏</span>
                <h3>Jumping Jacks</h3>
                <p>Count your jumping jacks with real-time motion tracking and form feedback</p>
                <button class="start-btn">Start Workout</button>
            </div>
        </div>

        <div class="stats-section">
            <h2 style="text-align: center; margin-bottom: 1.5rem;">üìä Today's Progress</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="pushups-count">0</div>
                    <div class="stat-label">Push-ups</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="squats-count">0</div>
                    <div class="stat-label">Squats</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="dumbbells-count">0</div>
                    <div class="stat-label">Dumbbell Curls</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="jumps-count">0</div>
                    <div class="stat-label">Jumping Jacks</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workout Window -->
    <div class="workout-window" id="workoutWindow">
        <div class="workout-content">
            <button class="close-btn" onclick="closeWorkout()">&times;</button>
            <h2 id="exercise-title">Push-ups Workout</h2>

            <div class="webcam-placeholder" id="webcamContainer">
                <video id="videoElement" style="display: none;" autoplay muted></video>
                <canvas id="canvasElement" style="display: none;"></canvas>
                <div class="angle-display" id="angleDisplay" style="display: none;">Angle: --¬∞</div>
                <div class="pose-status" id="poseStatus" style="display: none;">Ready</div>
                <div id="placeholderContent" style="text-align: center; color: #888;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üìπ</div>
                    <div>Click "Start Camera" to begin pose tracking</div>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem;">Built-in AI pose detection</div>
                </div>
            </div>

            <div class="exercise-status" id="exercise-status">Ready to start your workout!</div>
            <div class="exercise-counter" id="exercise-counter">0</div>

            <div class="control-buttons">
                <button class="control-btn start-workout-btn" onclick="startWebcam()" id="startBtn">
                    üé• Start Camera
                </button>
                <button class="control-btn stop-btn" onclick="stopWorkout()" id="stopBtn">
                    ‚èπÔ∏è Stop
                </button>
                <button class="control-btn reset-btn" onclick="resetCounter()" id="resetBtn">
                    üîÑ Reset
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

    <script>
        let currentExercise = '';
        let isWorkoutActive = false;
        let exerciseCount = 0;
        let videoElement, canvasElement, canvasCtx;
        let pose;
        let camera;

        // Push-up tracking variables
        let pushupState = "up";
        let currentAngle = 0;

        // Exercise data
        const exercises = {
            'pushups': {
                title: 'Push-ups Workout',
                icon: 'üí™',
                script: 'pushups_tracker.py'
            },
            'squats': {
                title: 'Squats Workout',
                icon: 'ü¶µ',
                script: 'squats_tracker.py'
            },
            'dumbbells': {
                title: 'Dumbbell Curls Workout',
                icon: 'üèãÔ∏è',
                script: 'dumbbells_tracker.py'
            },
            'jumps': {
                title: 'Jumping Jacks Workout',
                icon: 'ü§∏',
                script: 'jumps_tracker.py'
            }
        };

        function startExercise(exerciseType) {
            currentExercise = exerciseType;
            const exercise = exercises[exerciseType];

            document.getElementById('exercise-title').textContent = exercise.title;
            document.getElementById('workoutWindow').style.display = 'block';
            document.getElementById('exercise-status').textContent = 'Ready to start your workout!';
            document.getElementById('exercise-counter').textContent = '0';

            // Reset workout state
            isWorkoutActive = false;
            exerciseCount = 0;

            // Update button states
            updateButtonStates();
        }

        function closeWorkout() {
            document.getElementById('workoutWindow').style.display = 'none';
            stopWorkout();
        }

        // Calculate angle between three points (same as your Python script)
        function calculateAngle(a, b, c) {
            const radians = Math.atan2(c.y - b.y, c.x - b.x) - Math.atan2(a.y - b.y, a.x - b.x);
            let angle = Math.abs(radians * 180.0 / Math.PI);

            if (angle > 180.0) {
                angle = 360 - angle;
            }

            return angle;
        }

        // Initialize MediaPipe Pose
        function initializePose() {
            videoElement = document.getElementById('videoElement');
            canvasElement = document.getElementById('canvasElement');
            canvasCtx = canvasElement.getContext('2d');

            pose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                }
            });

            pose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                smoothSegmentation: true,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });

            pose.onResults(onResults);
        }

        // Process pose detection results
        function onResults(results) {
            if (!isWorkoutActive) return;

            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

            // Draw the video frame
            canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

            if (results.poseLandmarks) {
                // Draw pose landmarks
                drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
                drawLandmarks(canvasCtx, results.poseLandmarks, {color: '#FF0000', lineWidth: 1});

                // Process exercise-specific logic
                if (currentExercise === 'pushups') {
                    processPushups(results.poseLandmarks);
                } else {
                    processOtherExercises(results.poseLandmarks);
                }
            }

            canvasCtx.restore();
        }

        // Process pushup detection (matching your Python logic)
        function processPushups(landmarks) {
            try {
                // Get right arm landmarks (same as your Python script)
                const shoulder = landmarks[12]; // RIGHT_SHOULDER
                const elbow = landmarks[14];    // RIGHT_ELBOW
                const wrist = landmarks[16];    // RIGHT_WRIST

                // Calculate elbow angle
                currentAngle = calculateAngle(shoulder, elbow, wrist);

                // Update angle display
                document.getElementById('angleDisplay').textContent = `Angle: ${Math.round(currentAngle)}¬∞`;

                // Push-up counting logic (same as your Python script)
                if (currentAngle < 90) {
                    pushupState = "down";
                    document.getElementById('poseStatus').textContent = "Down";
                    document.getElementById('exercise-status').textContent = 'Down position - Keep going!';
                }

                if (currentAngle > 160 && pushupState === "down") {
                    pushupState = "up";
                    exerciseCount++;
                    document.getElementById('exercise-counter').textContent = exerciseCount;
                    document.getElementById('poseStatus').textContent = "Up";
                    document.getElementById('exercise-status').textContent = 'Push-up completed! ‚úÖ';

                    // Brief celebration
                    setTimeout(() => {
                        if (isWorkoutActive) {
                            document.getElementById('exercise-status').textContent = 'Keep going! Perfect form!';
                        }
                    }, 1000);
                }

                // Draw angle on canvas
                const elbowX = elbow.x * canvasElement.width;
                const elbowY = elbow.y * canvasElement.height;

                canvasCtx.fillStyle = 'white';
                canvasCtx.font = '20px Arial';
                canvasCtx.fillText(`${Math.round(currentAngle)}¬∞`, elbowX + 10, elbowY - 10);

            } catch (error) {
                console.log('Pose detection error:', error);
            }
        }

        // Process other exercises
        function processOtherExercises(landmarks) {
            // Generic exercise detection for squats, dumbbells, jumps
            document.getElementById('poseStatus').textContent = "Tracking";

            // Simple movement detection for demo
            if (Math.random() > 0.98) { // Occasional rep detection
                exerciseCount++;
                document.getElementById('exercise-counter').textContent = exerciseCount;
                document.getElementById('exercise-status').textContent = 'Rep completed! üéØ';
            }
        }

        async function startWebcam() {
            if (!isWorkoutActive) {
        try {
            isWorkoutActive = true;
            document.getElementById('exercise-status').textContent = `Starting camera...`;
            updateButtonStates();

            if (!pose) {
                initializePose();
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            console.log('Requesting camera access...');
            const stream = await navigator.mediaDevices.getUserMedia({
                video: {
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    facingMode: 'user'
                }
            });

            console.log('Camera access granted, setting up video...');
            videoElement.srcObject = stream;

            // --- THIS IS THE FIX ---
            // Manually play the video element to ensure it's active
            videoElement.play();

            // Wait for video to be ready
            await new Promise((resolve) => {
                videoElement.onloadedmetadata = () => {
                    console.log('Video metadata loaded');
                    canvasElement.width = videoElement.videoWidth;
                    canvasElement.height = videoElement.videoHeight;
                    resolve();
                };
            });

            // Show video elements
            document.getElementById('placeholderContent').style.display = 'none';
            document.getElementById('videoElement').style.display = 'block';
            document.getElementById('canvasElement').style.display = 'block';
            document.getElementById('angleDisplay').style.display = 'block';
            document.getElementById('poseStatus').style.display = 'block';

            // Start pose detection
            camera = new Camera(videoElement, {
                onFrame: async () => {
                    if (isWorkoutActive && pose) {
                        await pose.send({image: videoElement});
                    }
                },
                width: 640,
                height: 480
            });

            await camera.start();
            console.log('Camera and pose detection started successfully');
            document.getElementById('exercise-status').textContent = 'Camera active - Start exercising!';

        } catch (error) {
            console.error('Error starting webcam:', error);
            // ... (rest of the error handling code is the same)
            isWorkoutActive = false;
            updateButtonStates();
            let errorMessage = 'Error accessing camera. ';
            if (error.name === 'NotAllowedError') {
                errorMessage += 'Please allow camera access and try again.';
            } else if (error.name === 'NotFoundError') {
                errorMessage += 'No camera found on this device.';
            } else {
                errorMessage += 'Please check your camera permissions and try again.';
            }
            alert(errorMessage);
            document.getElementById('placeholderContent').style.display = 'block';
            document.getElementById('videoElement').style.display = 'none';
            document.getElementById('canvasElement').style.display = 'none';
            document.getElementById('angleDisplay').style.display = 'none';
            document.getElementById('poseStatus').style.display = 'none';
        }
    }
        }

        function stopWorkout() {
            isWorkoutActive = false;
            document.getElementById('exercise-status').textContent = 'Workout stopped';

            // Stop camera
            if (camera) {
                camera.stop();
            }

            // Stop video stream
            if (videoElement && videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
            }

            // Hide video elements and show placeholder
            document.getElementById('videoElement').style.display = 'none';
            document.getElementById('canvasElement').style.display = 'none';
            document.getElementById('angleDisplay').style.display = 'none';
            document.getElementById('poseStatus').style.display = 'none';
            document.getElementById('placeholderContent').style.display = 'block';

            updateButtonStates();

            // Update daily stats
            updateDailyStats();

            console.log('Camera and pose detection stopped');
        }

        function resetCounter() {
            exerciseCount = 0;
            document.getElementById('exercise-counter').textContent = '0';
            document.getElementById('exercise-status').textContent = 'Counter reset - Ready to start!';
        }

        function updateButtonStates() {
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');

            if (isWorkoutActive) {
                startBtn.textContent = 'üé• Camera Active';
                startBtn.style.background = '#666';
                startBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                startBtn.textContent = 'üé• Start Camera';
                startBtn.style.background = '#00ff88';
                startBtn.disabled = false;
                stopBtn.disabled = false;
            }
        }



        function updateDailyStats() {
            const currentCount = parseInt(document.getElementById(`${currentExercise}-count`).textContent);
            document.getElementById(`${currentExercise}-count`).textContent = currentCount + exerciseCount;
        }

        // Close workout window when clicking outside
        document.getElementById('workoutWindow').addEventListener('click', function(e) {
            if (e.target === this) {
                closeWorkout();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('workoutWindow').style.display === 'block') {
                if (e.key === 'Escape') {
                    closeWorkout();
                } else if (e.key === ' ') {
                    e.preventDefault();
                    if (!isWorkoutActive) {
                        startWebcam();
                    } else {
                        stopWorkout();
                    }
                } else if (e.key === 'r' || e.key === 'R') {
                    resetCounter();
                }
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9671efc5a54291ec',t:'MTc1Mzg0Nzg5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
